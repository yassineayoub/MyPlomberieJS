let jsonTubes = JSON.stringify([{
        "contenance": 0.028,
        "diamExt": 8,
        "diamInt": 6,
        "ep": 1,
        "id": 2,
        "type": "cuivre"
    },
    {
        "contenance": 0.05,
        "diamExt": 10,
        "diamInt": 8,
        "ep": 1,
        "id": 3,
        "type": "cuivre"
    },
    {
        "contenance": 0.079,
        "diamExt": 12,
        "diamInt": 10,
        "ep": 1,
        "id": 4,
        "type": "cuivre"
    },
    {
        "contenance": 0.113,
        "diamExt": 14,
        "diamInt": 12,
        "ep": 1,
        "id": 5,
        "type": "cuivre"
    },
    {
        "contenance": 0.154,
        "diamExt": 16,
        "diamInt": 14,
        "ep": 1,
        "id": 7,
        "type": "cuivre"
    },
    {
        "contenance": 0.201,
        "diamExt": 18,
        "diamInt": 16,
        "ep": 1,
        "id": 8,
        "type": "cuivre"
    },
    {
        "contenance": 0.314,
        "diamExt": 22,
        "diamInt": 20,
        "ep": 1,
        "id": 9,
        "type": "cuivre"
    },
    {
        "contenance": 0.531,
        "diamExt": 28,
        "diamInt": 26,
        "ep": 1,
        "id": 10,
        "type": "cuivre"
    },
    {
        "contenance": 0.707,
        "diamExt": 32,
        "diamInt": 30,
        "ep": 1,
        "id": 11,
        "type": "cuivre"
    },
    {
        "contenance": 0.855,
        "diamExt": 35,
        "diamInt": 33,
        "ep": 1,
        "id": 12,
        "type": "cuivre"
    },
    {
        "contenance": 1.134,
        "diamExt": 40,
        "diamInt": 38,
        "ep": 1,
        "id": 13,
        "type": "cuivre"
    },
    {
        "contenance": 1.257,
        "diamExt": 42,
        "diamInt": 40,
        "ep": 1,
        "id": 14,
        "type": "cuivre"
    },
    {
        "contenance": 1.232,
        "diamExt": 42,
        "diamInt": 39.6,
        "ep": 1.2,
        "id": 15,
        "type": "cuivre"
    },
    {
        "contenance": 1.963,
        "diamExt": 52,
        "diamInt": 50,
        "ep": 1,
        "id": 16,
        "type": "cuivre"
    },
    {
        "contenance": 2.124,
        "diamExt": 54,
        "diamInt": 52,
        "ep": 1,
        "id": 17,
        "type": "cuivre"
    },
    {
        "contenance": 2.091,
        "diamExt": 54,
        "diamInt": 51.6,
        "ep": 1.2,
        "id": 18,
        "type": "cuivre"
    },
    {
        "contenance": 2.043,
        "diamExt": 54,
        "diamInt": 51,
        "ep": 1.5,
        "id": 19,
        "type": "cuivre"
    },
    {
        "contenance": 2.827,
        "diamExt": 64,
        "diamInt": 60,
        "ep": 2,
        "id": 20,
        "type": "cuivre"
    },
    {
        "contenance": 4.083,
        "diamExt": 76.1,
        "diamInt": 72.1,
        "ep": 2,
        "id": 21,
        "type": "cuivre"
    },
    {
        "contenance": 5.661,
        "diamExt": 88.9,
        "diamInt": 84.9,
        "ep": 2,
        "id": 22,
        "type": "cuivre"
    },
    {
        "contenance": 8.332,
        "diamExt": 108,
        "diamInt": 103,
        "ep": 2.5,
        "id": 23,
        "type": "cuivre"
    },
    {
        "contenance": 0.075,
        "diamExt": 12,
        "diamInt": 9.8,
        "ep": 1.1,
        "id": 24,
        "type": "PER"
    },
    {
        "contenance": 0.133,
        "diamExt": 16,
        "diamInt": 13,
        "ep": 1.5,
        "id": 25,
        "type": "PER"
    },
    {
        "contenance": 0.206,
        "diamExt": 20,
        "diamInt": 16.2,
        "ep": 1.9,
        "id": 26,
        "type": "PER"
    },
    {
        "contenance": 0.327,
        "diamExt": 25,
        "diamInt": 20.4,
        "ep": 2.3,
        "id": 27,
        "type": "PER"
    },
    {
        "contenance": 0.154,
        "diamExt": 20,
        "diamInt": 14,
        "ep": 3,
        "id": 28,
        "type": "PEHD"
    },
    {
        "contenance": 0.284,
        "diamExt": 25,
        "diamInt": 19,
        "ep": 3,
        "id": 29,
        "type": "PEHD"
    },
    {
        "contenance": 0.483,
        "diamExt": 32,
        "diamInt": 24.8,
        "ep": 3.6,
        "id": 30,
        "type": "PEHD"
    },
    {
        "contenance": 0.755,
        "diamExt": 40,
        "diamInt": 31,
        "ep": 4.5,
        "id": 31,
        "type": "PEHD"
    },
    {
        "contenance": 1.182,
        "diamExt": 50,
        "diamInt": 38.8,
        "ep": 5.6,
        "id": 32,
        "type": "PEHD"
    },
    {
        "contenance": 1.87,
        "diamExt": 63,
        "diamInt": 48.8,
        "ep": 7.1,
        "id": 33,
        "type": "PEHD"
    },
    {
        "contenance": 2.66,
        "diamExt": 75,
        "diamInt": 58.2,
        "ep": 8.4,
        "id": 34,
        "type": "PEHD"
    },
    {
        "contenance": 2.697,
        "diamExt": 90,
        "diamInt": 58.6,
        "ep": 8.2,
        "id": 35,
        "type": "PEHD"
    },
    {
        "contenance": 3.848,
        "diamExt": 110,
        "diamInt": 70,
        "ep": 10,
        "id": 36,
        "type": "PEHD"
    },
    {
        "contenance": 5.972,
        "diamExt": 125,
        "diamInt": 87.2,
        "ep": 11.4,
        "id": 37,
        "type": "PEHD"
    },
    {
        "contenance": 7.791275445,
        "diamExt": 140,
        "diamInt": 99.6,
        "ep": 12.7,
        "id": 38,
        "type": "PEHD"
    },
    {
        "contenance": 9.642050509,
        "diamExt": 160,
        "diamInt": 110.8,
        "ep": 14.6,
        "id": 39,
        "type": "PEHD"
    },
    {
        "contenance": 12.70761662,
        "diamExt": 180,
        "diamInt": 127.2,
        "ep": 16.4,
        "id": 40,
        "type": "PEHD"
    },
    {
        "contenance": 16.19566411,
        "diamExt": 200,
        "diamInt": 143.6,
        "ep": 18.2,
        "id": 41,
        "type": "PEHD"
    },
    {
        "contenance": 19.85565097,
        "diamExt": 225,
        "diamInt": 159,
        "ep": 20.5,
        "id": 42,
        "type": "PEHD"
    },
    {
        "contenance": 25.33392882,
        "diamExt": 250,
        "diamInt": 179.6,
        "ep": 22.7,
        "id": 43,
        "type": "PEHD"
    },
    {
        "contenance": 31.16510178,
        "diamExt": 280,
        "diamInt": 199.2,
        "ep": 25.4,
        "id": 44,
        "type": "PEHD"
    },
    {
        "contenance": 38.98703917,
        "diamExt": 315,
        "diamInt": 222.8,
        "ep": 28.6,
        "id": 45,
        "type": "PEHD"
    },
    {
        "contenance": 49.3232874,
        "diamExt": 355,
        "diamInt": 250.6,
        "ep": 32.2,
        "id": 46,
        "type": "PEHD"
    },
    {
        "contenance": 62.63531504,
        "diamExt": 400,
        "diamInt": 282.4,
        "ep": 36.3,
        "id": 47,
        "type": "PEHD"
    },
    {
        "contenance": 79.52253794,
        "diamExt": 450,
        "diamInt": 318.2,
        "ep": 40.9,
        "id": 48,
        "type": "PEHD"
    },
    {
        "contenance": 101.3357153,
        "diamExt": 500,
        "diamInt": 359.2,
        "ep": 45.4,
        "id": 49,
        "type": "PEHD"
    },
    {
        "contenance": 124.6604071,
        "diamExt": 560,
        "diamInt": 398.4,
        "ep": 50.8,
        "id": 50,
        "type": "PEHD"
    },
    {
        "contenance": 155.9481567,
        "diamExt": 630,
        "diamInt": 445.6,
        "ep": 57.2,
        "id": 51,
        "type": "PEHD"
    },
    {
        "contenance": 0.113,
        "diamExt": 16,
        "diamInt": 12,
        "ep": 2,
        "id": 52,
        "type": "multicouche"
    },
    {
        "contenance": 0.189,
        "diamExt": 20,
        "diamInt": 15.5,
        "ep": 2.25,
        "id": 53,
        "type": "multicouche"
    },
    {
        "contenance": 0.314,
        "diamExt": 25,
        "diamInt": 20,
        "ep": 2.5,
        "id": 54,
        "type": "multicouche"
    },
    {
        "contenance": 0.531,
        "diamExt": 32,
        "diamInt": 26,
        "ep": 3,
        "id": 55,
        "type": "multicouche"
    },
    {
        "contenance": 0.804,
        "diamExt": 40,
        "diamInt": 32,
        "ep": 4,
        "id": 56,
        "type": "multicouche"
    },
    {
        "contenance": 1.32,
        "diamExt": 50,
        "diamInt": 41,
        "ep": 4.5,
        "id": 57,
        "type": "multicouche"
    },
    {
        "contenance": 2.043,
        "diamExt": 63,
        "diamInt": 51,
        "ep": 6,
        "id": 58,
        "type": "multicouche"
    },
    {
        "contenance": 2.827,
        "diamExt": 75,
        "diamInt": 60,
        "ep": 7.5,
        "id": 59,
        "type": "multicouche"
    },
    {
        "contenance": 4.185,
        "diamExt": 90,
        "diamInt": 73,
        "ep": 8.5,
        "id": 60,
        "type": "multicouche"
    },
    {
        "contenance": 6.362,
        "diamExt": 110,
        "diamInt": 90,
        "ep": 10,
        "id": 61,
        "type": "multicouche"
    }
]);
let jsonEquips = JSON.stringify([{
        "coeff": 2.5,
        "debitMin": 0.2,
        "diamEvac": 40,
        "diamMin": 12,
        "id": 1,
        "name": "Evier"
    },
    {
        "coeff": 1.5,
        "debitMin": 0.2,
        "diamEvac": 32,
        "diamMin": 10,
        "id": 2,
        "name": "Lavabo"
    },
    {
        "coeff": 1,
        "debitMin": 0.2,
        "diamEvac": 32,
        "diamMin": 10,
        "id": 3,
        "name": "Bidet"
    },
    {
        "coeff": 3,
        "debitMin": 0.33,
        "diamEvac": 40,
        "diamMin": 13,
        "id": 4,
        "name": "Baignoire ≤ 150 L"
    },
    {
        "coeff": 3.5,
        "debitMin": 0.33,
        "diamEvac": 50,
        "diamMin": 13,
        "id": 5,
        "name": "Baignoire 170 L"
    },
    {
        "coeff": 2,
        "debitMin": 0.2,
        "diamEvac": 40,
        "diamMin": 12,
        "id": 6,
        "name": "Douche"
    },
    {
        "coeff": 2,
        "debitMin": 0.33,
        "diamEvac": 40,
        "diamMin": 12,
        "id": 7,
        "name": "Poste d'eau avec robinet 1/2"
    },
    {
        "coeff": 0.5,
        "debitMin": 0.12,
        "diamEvac": 100,
        "diamMin": 10,
        "id": 8,
        "name": "WC"
    },
    {
        "coeff": 0.5,
        "debitMin": 0.15,
        "diamEvac": 40,
        "diamMin": 10,
        "id": 9,
        "name": "Urinoir"
    },
    {
        "coeff": 0.5,
        "debitMin": 0.1,
        "diamEvac": 32,
        "diamMin": 10,
        "id": 10,
        "name": "Lave-mains"
    },
    {
        "coeff": 2,
        "debitMin": 0.33,
        "diamEvac": 40,
        "diamMin": 13,
        "id": 11,
        "name": "Bac à laver"
    },
    {
        "coeff": 1,
        "debitMin": 0.2,
        "diamEvac": 40,
        "diamMin": 10,
        "id": 12,
        "name": "Lave-linge"
    },
    {
        "coeff": 1,
        "debitMin": 0.1,
        "diamEvac": 40,
        "diamMin": 10,
        "id": 13,
        "name": "Lave-vaisselle"
    }
]);

const coefficiantDiametre = {
    2: 11,
    2.5: 11.5,
    3: 12,
    3.5: 13,
    4: 13.7,
    4.5: 14,
    5: 14.4,
    5: 14.4,
    5.5: 15,
    6: 15.8,
    6.5: 16,
    7: 16.2,
    7.5: 16.4,
    8: 17,
    8.5: 17.2,
    9: 17.5,
    9.5: 17.8,
    10: 18,
    10.5: 18.2,
    11: 18.6,
    11.5: 19,
    12: 19.2,
    12.5: 19.5,
    13: 19.7,
    13.5: 19.8,
    14: 20,
    14.5: 20,
    15: 20.1,
}
const equips = new Equipements;
const tubeClass = new Tubes;
const html = new HTML;
const coefficiants = new Coefficiants;

html.createTubeListOptions();

const tubes = JSON.parse(jsonTubes);
const equipements = JSON.parse(jsonEquips);
// const tubeMat = ['cuivre', 'PER', 'multicouche', 'PEHD'];

// equipements à afficher de base dans la page
const equipementsToDontShow = ['Evier', 'Lavabo', 'Douche', 'WC', 'Lave-linge', 'Lave-vaisselle'];

// import des équipements dans le select
const selectEquipement = document.querySelector('#equipSelect');
selectEquipement.classList.add('select')
// on boucle sur la fonction pour inserer chaque equipement(options) dans le select
const selectOptions = insertOptionToSelect(selectEquipement, equipements, equipementsToDontShow);
//div container ( balise form )
const formContainer = document.querySelector('.form.equip');


//bouton d'ajouts des equipements
const addEquipButton = document.querySelector("#equipSelectBtn");
addEquipButton.classList.add('selectBtn')



// bouton de calcul 
const calcButton = document.querySelector('#submit-form');
// calcButton.classList.add('btn')
// calcButton.textContent = "Calculer";
// calcButton.id = "submit-form";
//Form selector
const form = document.querySelector('form');

// Tout les inputs 

//Reset button
const resetBtn = document.querySelector('a.reset');
// resetBtn.className = ('reset')
// resetBtn.href = window.location.href;
// resetBtn.textContent = "Reset";




//Secteur de tubes :

// let createTubeOptions = function () {
//     const tubeSelector = document.querySelector('#tubeSelector');
//     tubeSelector.classList.add('select')
//     for (const tube of tubeMat) {
//         const tubeOption = document.createElement('option');
//         tubeOption.textContent = ucFirst(tube);
//         tubeOption.value = tube;
//         tubeSelector.append(tubeOption);
//     }
// }

// createTubeOptions();

//on insert dans le DOM les équipements standard à afficher :
// si la fonction isOptionToShowInSelect est === false
equipements.forEach(equipement => {
    if (!isOptionToShowInSelect(equipement.name, equipementsToDontShow)) {
        // Pour chaque equipements présent dans l'array , on créer un input 
        createInput(equipement.name, equipement.coeff)
    }
});




// fonction pour choisir les élément a ne pas afficher dans le select
function isOptionToShowInSelect(items, itemsToDontShow) {
    if (itemsToDontShow.includes(items)) {
        return false
    } else {
        return true;
    }
}

function insertOptionToSelect(selectName, arrayToInsert, equipementsToDontShow) {
    for (let i = 0; i < arrayToInsert.length; i++) {
        //si l'equipement n'est pas présent dans la liste déja affiché de base alors :
        if (isOptionToShowInSelect(arrayToInsert[i].name, equipementsToDontShow)) {
            let equipement = arrayToInsert[i];
            let name = lcFirst(equipement.name);
            //création d'une option du select
            let option = document.createElement('option');
            option.setAttribute('value', equipement.name);
            option.className = name;
            option.innerHTML = equipement.name;
            name = name.replace(/\s+/g, "");
            selectName.appendChild(option);
        }

    }
}


function createInput(equipName, coeff) {
    // on met en minuscule la 1ere lettre
    optionClass = stringGroup(lcFirst(equipName));
    // optionClass.replace(/\s+/g, '')

    //creation de la div GENERAL pour chaque equipement
    const formGroupDiv = document.createElement('div');
    //Ajout des différentes class :
    formGroupDiv.classList.add(optionClass.replace(/\s+/g, ''), 'form-group');
    document.querySelector('div.equip').appendChild(formGroupDiv)

    //creation de la div qui contiendra l'inpput et ajout au form-group
    let divContainer = document.createElement('div')
   
    html.createFormLabel(equipName,formGroupDiv);

    //creation du form Input
    html.createFormInput(equipName, divContainer)
 
    //ajout du divContainer au form group
    divContainer.classList.add('container')
    formGroupDiv.appendChild(divContainer)

    //insertion button 
    html.createFormDeleteBtn(formGroupDiv)

}

/**
 * Retourne le coefficant correspondant a l'équipement
 * @param {string} equipName Nom de l'équipement
 */
function getCoeffEquip(equipName) {
    for (const equip of equipements) {
        if (equip.name === equipName) {
            return equip.coeff;
        }
    }
}

/**
 * Retourne le diametre interieur minimal en fonction du nom de l'équipement
 * @param {string} equipName Nom de l'équipement
 */
// function getDiamMinEquip(equipName) {
//     for (const equip of equipements) {
//         if (equip.name === equipName) {
//             // console.log(equip.diamMin);
//             return equip.diamMin;
//         }
//     }
// }




const deleteBtn = document.querySelectorAll(".btn--delete");
for (let i = 0; i < deleteBtn.length; i++) {
    deleteBtn[i].addEventListener('click', handlerdeleteAddEquipement);
}


//supprime le form-group div le plus proche du bouton "btn--delete" et l'ajoute dans l'option du select
function handlerdeleteAddEquipement() {
    let optionToAdd = this.closest(".form-group").firstChild.textContent;
    createOption(optionToAdd, selectEquipement)
    this.closest(".form-group").remove()
}

function createOption(optionName, selectName) {
    let option = document.createElement('option');
    option.value = optionName;
    option.textContent = optionName;
    selectName.append(option);
}





function ucFirst(string) {
    let str = string
    return (str.charAt(0).toUpperCase() + str.substring(1));
}

function lcFirst(string) {
    // Mettre en minuscle la premiere lettre :
    let str = string
    return (str.charAt(0).toLocaleLowerCase() + str.substring(1));
}




//* Span où l'on affichera le diametre général
const spanGlobalResult = document.querySelector('#result');



/**
 * Fonction qui permet de calculer la somme de tout les inputs * coefficant (data-coeff)
 * @param {HTMLCollection} inputs 
 * @returns number
 */
let calcInputsValue = function (inputs) {
    let globalCoefficiant = 0;
    for (i = 0; i < inputs.length; i++) {
        if (inputs[i] !== 0) {
            globalCoefficiant += Number(inputs[i].value * inputs[i].dataset.coeff);
        }
    }
    return globalCoefficiant < 2 && globalCoefficiant > 0 ? 2 : globalCoefficiant
}


//Function pour mettre des tirets dans les string si elle presente des espaces de nom, exemple poste d'eau = poste-d'eau
function stringGroup(name) {
    return name.replace(/((?<![\\])[\s\/'"])/g, "_");
}

/**
 * Function qui calcul le diamètre minimal de l'alimentation générale
 * @param {param} globalCoefficiant 
 * @returns number | false
 */
// let getDiamMinGlobal = function (globalCoefficiant) {
//     let diamMinGlobal;
//     for (const key in coefficiantDiametre) {
//         if (globalCoefficiant === Number(key)) {
//             // console.log(coefficiantDiametre[key]);
//             diamMinGlobal = coefficiantDiametre[key];
//         }
//     }
//     if (diamMinGlobal === undefined) {
//         return false;
//     }
//     return diamMinGlobal;
// }


/**
 * Function qui va afficher le diamètre minimum GENERAL dans le span 'spanGlobalResult'
 * @param {param} diamMinGlobal // Le diamètre a afficher
 * @param {*} elementClassorId // représente la classe ou l'id de l'element dans lequel on veut display le diametre
 */
let displayGlobalDiamMin = function (diamMinGlobal, elementClassorId) {
    const text = "Diamètre intérieur minimal du tuyau d'alimentation générale : ";
    const appendTo = document.querySelector(elementClassorId);
    // console.log(appendTo);
    return appendTo.textContent = text + diamMinGlobal + " mm";
}



/**
 * 
 * Function qui check si le Diamètre général minimum n'est pas hors champ.
 * Si la valeur est hors champ on affiche un message d'erreur avec un fond rouge
 * Si la le form est soumis sans aucune valeur fond rouge avec message d'erreur
 * Sinon on affiche la valeur avec un fond vert
 */

let checkValue = function (value, inputsValue) {
    if (inputsValue === 0 && value === false) {
        spanGlobalResult.className = "result error"
        spanGlobalResult.innerHTML = "Erreur ! Veuillez saisir au moins un champ !";
        return false;
    } else if (!value || value > 20.1) {
        spanGlobalResult.className = "result error"
        spanGlobalResult.innerHTML = "Erreur ! Vous disposez de trop d'équipements pour utiliser cette méthode de calcul. <br/> <strong>La méthode 'Collective'</strong> serait plus appropriée."
        return false;
    } else {
        displayGlobalDiamMin(value, "#result");
        spanGlobalResult.className = "result success"
        return true;
    }
}
/**
 * Recupère le matériaux choisi par l'utilisateur
 * @returns 
 */
// let getMat = function () {
//     return tubeSelector.value;
// }

// On veut rechercher dans l'object le diamètre qui se rapproche de 'globalDiamMin' qui correspond au tube selectionné
// on commence par selectionner tout les diametres qui correspondent au tube selectionné

/**
 * Récupère la 1ere array !undefined
 * @param {Object} object Object dans lequel prendre le plus petit diametre
 * @returns 
 */
// const getMinDiam = function (object) {
//     for (const diameter of object) {
//         if (diameter !== undefined) {
//             return diameter;
//         }
//     }
// }
// useless
// function minDiamFormLabel(formGroup) {
//     for (const equip of equipements) {
//         if (formGroup.firstChild.textContent === equip.name) {
//             return equip.diamMin;
//         };
//     }
// }

/**
 * Retourne true si l'input est vide ou false s'il est remmpli
 * @param {*} formGroupDiv 
 */
function isEmpty(value) {
    if (value === 0 || value === undefined || value === "") {
        return true;
    } else {
        return false;
    }
}

/**
 *Créer la déscription pour chaques equipements //
 * Renvoi le tube a installer et le diametre minimal
 */
function createDivDescription() {
    const formGroupDiv = document.querySelectorAll('.form-group')
    for (i = 0; i < formGroupDiv.length; i++) {
        //on récupère la valeur de l'input contenu dans chaque formGroupDiv
        const inputValue = formGroupDiv[i].children[1].firstChild.value
        //Si l'input n'est pas vide on exécute le code
        // let diamMin = minDiamFormLabel(formGroupDiv[i])
        let equipementName = formGroupDiv[i].firstChild.textContent
        let diamMin = equips.getDiamMinEquip(equipementName)

        //On créer la div qui va contenir les 3 p d'informations
        const div = document.createElement('div');
        div.classList.add('divDescrib');
        div.classList.add('hidden');

        const p = document.createElement('p');
        p.classList.add('pDescrib');
        p.innerHTML = `Tube à installer par <strong> ${equipementName} </strong> :`;

        const p1 = document.createElement('p');
        p1.classList.add('pDescrib');
        p1.innerHTML = `Diamètre <strong>intérieur minimal</strong> : <strong> ${diamMin} mm </strong>`

        const p2 = document.createElement('p');
        p2.classList.add('pDescrib');

        div.append(p);
        div.append(p1);
        div.append(p2);
        formGroupDiv[i].after(div);

    }
}

/**
 * Retourne 
 * @param {number} minDiam 
 */
function getTubeSize(minDiam, mat) {
    for (const tube of tubes) {
        if (tube.diamInt >= minDiam && tube.type === mat)
            return tube.diamInt
    }
}
// Récupere le diametre interieur minimal en fonction de l'équipement saisie
function minSizeEquip(equipName) {
    for (const equip of equipements) {
        if (equipName === equip.name) {
            return equip.diamMin;
        }
    }
}
// Retourne le matériau , le diamExt et l'epaisseur du tube à installer
function getDiamPerEquip(diamMinEquip) {
    let value = []
    for (const tube of tubes) {
        if (tube.type === html.getSelectorMat() && tube.diamInt >= diamMinEquip) {
            return value = [ucFirst(tube.type), tube.diamExt, tube.ep]
        }
    }
    return value;
}


let handleInsertEquipTube = function (e) {
    e.preventDefault()
    // on recupere tout les form-labels 
    let formLabels = document.querySelectorAll('.form-label')
    // Pour chaque label, on récupere le LabelName
    for (const labels of formLabels) {
        //Nom de chaque input affiché // Evier , Lavabo ...
        const labelName = labels.textContent
        //Diametre min en fonction de l'équipement ex : Evier = 12
        const sizeMin = equips.getDiamMinEquip(labelName);
        //Tube à installer [cuivre,diamExt,epaisseur] 
        const tubeToInstall = getDiamPerEquip(sizeMin);
        //On créer le text à afficher dans le paragraphe en question
        let text = "";
        if (tubeToInstall.length !== 0) {
            text = `Tube recommandé :<strong>  ${tubeToInstall[0]} Ø ${tubeToInstall[1]} x ${tubeToInstall[2]} mm </strong>`
        } else {
            text = "Tube recommandé : <strong>Veuillez choisir un matériau</strong>";
        }
        //On va chercher le pDescrib dans lequel modifier le text 
        let pDescrib = labels.parentNode.nextSibling.lastChild;
        //On modifie le textContent :
        pDescrib.innerHTML = text;
    }

}

/**
 *Handler qui renvoi affiche les données sur l'alimentation générale à installer
 *
 * @param {*} e
 */
let handleInsertGereralTube = function (e) {
    e.preventDefault();
    const inputs = document.querySelectorAll('.form-control')
    //Calcul du coefficiant global
    const globalCoefficiant = html.calcInputsValue(inputs);

    // Calcul du diametre général minimal 
    const globalDiamMin = coefficiants.getDiamMinGlobal(globalCoefficiant);

    //Verification des champs et affichage dans la span en haut du form
    const verif = checkValue(globalDiamMin, globalCoefficiant);

    //Recupération du matériau séléctionné
    const mat = html.getSelectorMat();

    //Callback qui trie l'object en fonction de son matériau et du diametre minimal
    //Retour une array qui contient tout les diametres supérieur a globalDiamMin
    let callbackTube = function (element) {
        if (element.type == mat && globalDiamMin <= element.diamInt) {
            return [element.diamExt, element.ep]
        }
    }

    let tubeSelection = tubes.map(callbackTube);

    //On selectionne l'array la plus petite du tableau mais plus grande que globalDiamMin
    const diamGeneralToInstall = tubeClass.getMinDiam(tubeSelection);
    //On display le resultat avec le materiau et le diametre à installer
    if (verif) {
        html.displayGlobalDiamMinWithMat(mat, diamGeneralToInstall);
    }
    html.showDescription()
    // const formInput = document.querySelectorAll('.form-control')

    // for (const input of formInput) {
    //     if (parseInt(input.value) > 0) {
    //         let describ = input.parentNode.nextSibling.parentNode.nextSibling;
    //         describ.classList.remove('hidden');
    //     }
    // }
}


//On veut que l'element du select s'ajoute a la liste des matériaux 
let handleAddEquipement = function () {
    let equipName = selectEquipement.value;
    createInput(equipName, getCoeffEquip(equipName));

    let divContainer = document.querySelector(`.${stringGroup(lcFirst(equipName))}.form-group`)

    //On créer la div qui va contenir les 3 p d'informations
    const div = html.createDiv(null,['divDescrib','hidden'])

    //Creation des pDescription
    const textFirstP = `Tube à installer par <strong> ${equipName} </strong> :`;
    const textSecondP = `Diamètre <strong>intérieur minimal</strong> : <strong> ${equips.getDiamMinEquip(equipName)} mm </strong>`;
    html.createPDescription('pDescrib',textFirstP,div)
    html.createPDescription('pDescrib',textSecondP,div)
    html.createPDescription('pDescrib',null,div)

    divContainer.after(div);

    //Rend les boutons ajoutés supprimable
    const deleteBtn = document.querySelectorAll(".btn--delete");
    for (let i = 0; i < deleteBtn.length; i++) {
        deleteBtn[i].addEventListener('click', handlerdeleteAddEquipement);
    }

}

//Enleve une option du select a l'ajout dans la liste
let removeOption = function (e) {
    e.preventDefault();
    let optionToRemove = document.querySelector(`option[value="${selectEquipement.value}"`)
    optionToRemove.remove();
}



createDivDescription()
addEquipButton.addEventListener('click', handleAddEquipement)
addEquipButton.addEventListener('click', removeOption)
calcButton.addEventListener('click', handleInsertEquipTube)
calcButton.addEventListener('click', handleInsertGereralTube)